#!/bin/bash

host=$1

# Validate that the hostname looks like a FQDN
echo $host | grep -q -E "^[-\.a-zA-Z0-9]+$"

if [ $? != 0 ]; then
  echo "Error: Invalid host format"
  echo "Syntax: $0 [host.example.org]"
  exit 1
fi

INVENTORY_FILE="../coopsymbiotic-inventory/hosts"

if [[ "$host" =~ "civicrm.org" ]]; then
  INVENTORY_FILE="../civicrm-infra/ansible/hosts"
fi

env AEGIR_HOSTMASTER_HOSTNAME="$host" AEGIR_INVENTORY_ARGS="?site_status=1\&remote=1" ansible-playbook -i $INVENTORY_FILE -i ./bin/aegir-inventory -l "$host" -t icinga2-conf-host ./site.yml
